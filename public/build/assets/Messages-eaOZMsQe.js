import{u as ae,b as t,a as D,e as O,j as e,H as le,r as L}from"./app-WodD9T31.js";import{A as ie}from"./AuthenticatedLayout-DfCVmH_P.js";import{M as ne}from"./Modal-BLxUEzA6.js";import{P as R}from"./PrimaryButton-Ca6AWZ6U.js";import{T as U,I as oe}from"./TextInput-v2zqSfcU.js";import{I as T}from"./InputLabel-C5f6SDqH.js";import{P as G}from"./plus-CzztBUp5.js";import{c as N}from"./createLucideIcon-DvAImH0J.js";import{S as I}from"./search-CxFu_3tP.js";import{M as W}from"./message-square-CqAB2nUP.js";import{A as ce}from"./arrow-left-CUyrDpNx.js";import{V as de}from"./video-BijlaDYA.js";import{P as me}from"./phone-CyiG4HGS.js";import{S as xe}from"./send-DGuwmrB5.js";import{L as he}from"./lock-BEZuu3pN.js";import{X as ue}from"./x-ByFqY6Ut.js";import{U as ge}from"./user-DvMB5dXR.js";import{U as be}from"./users-CiV2fFqH.js";import"./image-DCDJmtNr.js";import"./star-C9-sC3Ed.js";import"./transition-Bv56m5Ro.js";const fe=[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]],ye=N("check-check",fe);const pe=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],H=N("ellipsis-vertical",pe);const je=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],ve=N("mic",je);const Ne=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]],we=N("smile",Ne),y=({src:c,alt:w,size:h="h-12 w-12"})=>e.jsx("div",{className:`${h} overflow-hidden rounded-full bg-gray-200 dark:bg-gray-700 flex-shrink-0`,children:e.jsx("img",{src:c,alt:w,className:"h-full w-full object-cover"})});function He({conversations:c=[],selectedConversation:w=null,messages:h=[],people:k=[]}){const p=ae().props.auth.user,[d,F]=t.useState(h),[u,V]=t.useState(""),[m,E]=t.useState("conversations"),[_,B]=t.useState(""),[S,C]=t.useState([]),[Q,n]=t.useState(!1),[X,j]=t.useState(!1),[J,g]=t.useState(!1),[M,P]=t.useState("individual"),A=t.useRef(null),b=t.useRef(null),a=w?.id||null,$=t.useMemo(()=>{const s=u.trim().toLowerCase();return s?c.filter(r=>(r?.other_user?.name||"").toLowerCase().includes(s)):c},[c,u]),K=s=>{if(!s)return"";const r=new Date(s);return Number.isNaN(r.getTime())?"":r.toLocaleString([],{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"})},z=t.useMemo(()=>{const s=u.trim().toLowerCase();return s?k.filter(r=>{const v=(r.name||"").toLowerCase(),x=(r.membership_number||"").toLowerCase();return v.includes(s)||x.includes(s)}):k},[k,u]),l=D({user_id:"",membership_number:""}),o=D({name:"",description:""}),i=D({body:""});t.useEffect(()=>{F(h)},[h,a]),t.useEffect(()=>{if(!a)return;const s=setInterval(async()=>{try{const r=d.length?d[d.length-1].id:0,x=(await O.get(route("messages.poll",a),{params:{after_id:r}}))?.data?.messages||[];x.length&&F(te=>[...te,...x])}catch{}},3e3);return()=>clearInterval(s)},[a,d]),t.useEffect(()=>{const s=A.current;s&&(s.scrollTop=s.scrollHeight)},[d,a]);const q=s=>{L.get(route("messages"),{conversation:s},{preserveScroll:!0,preserveState:!0})},Y=async s=>{const r=String(s||"").trim();if(!r){C([]),n(!1);return}try{const x=(await O.get(route("messages.search"),{params:{q:r}}))?.data?.results||[];C(x),n(!0)}catch{C([]),n(!0)}};t.useEffect(()=>{if(m==="messages")return b.current&&clearTimeout(b.current),b.current=setTimeout(()=>{Y(_)},350),()=>{b.current&&clearTimeout(b.current)}},[_,m]);const Z=s=>{s.preventDefault(),l.post(route("messages.start"),{preserveScroll:!0,onSuccess:()=>{g(!1),l.reset()}})},ee=s=>{s.preventDefault(),console.log("Creating group:",o.data),g(!1),o.reset()},se=s=>{s.preventDefault(),!(!a||!i.data.body.trim())&&(i.data.body,i.post(route("messages.store",a),{preserveScroll:!0,onSuccess:()=>{i.reset("body")}}))},re=()=>{L.get(route("messages"),{},{preserveState:!1})},f=c.find(s=>s.id===a);return e.jsxs(ie,{header:e.jsx("div",{className:"hidden",children:"Messages"}),children:[e.jsx(le,{title:"Messages"}),e.jsxs("div",{className:"-mx-4 -my-6 flex h-[calc(100vh-72px)] bg-white text-gray-900 sm:-mx-6 lg:-mx-8 overflow-hidden relative",children:[e.jsxs("div",{className:`${a?"hidden sm:flex":"flex"} w-full flex-col border-r border-gray-200 sm:w-[350px] lg:w-[400px] bg-white`,children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 h-[72px] flex-shrink-0 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx(y,{src:p?.avatar_url,alt:p?.name,size:"h-10 w-10"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"truncate text-sm font-black text-gray-900",children:"Physioplanet Messages"}),e.jsx("div",{className:"truncate text-xs text-gray-500",children:p?.email})]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-gray-600",children:[e.jsx("button",{type:"button",onClick:()=>g(!0),className:"inline-flex h-10 w-10 items-center justify-center rounded-xl border border-gray-200 bg-white hover:bg-gray-50","aria-label":"New chat",children:e.jsx(G,{className:"h-5 w-5"})}),e.jsx("button",{type:"button",className:"inline-flex h-10 w-10 items-center justify-center rounded-xl border border-gray-200 bg-white hover:bg-gray-50","aria-label":"More",children:e.jsx(H,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{className:"bg-white p-3 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("button",{type:"button",onClick:()=>{E("conversations"),n(!1)},className:"rounded-full px-3 py-1.5 text-[11px] font-black uppercase tracking-widest border "+(m==="conversations"?"border-emerald-200 bg-emerald-50 text-emerald-700":"border-gray-200 bg-white text-gray-600 hover:bg-gray-50"),children:"Chats"}),e.jsx("button",{type:"button",onClick:()=>{E("messages")},className:"rounded-full px-3 py-1.5 text-[11px] font-black uppercase tracking-widest border "+(m==="messages"?"border-emerald-200 bg-emerald-50 text-emerald-700":"border-gray-200 bg-white text-gray-600 hover:bg-gray-50"),children:"Messages"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3",children:e.jsx(I,{className:"h-4 w-4 text-gray-400"})}),m==="conversations"?e.jsx("input",{value:u,onChange:s=>V(s.target.value),placeholder:"Search conversations",className:"w-full rounded-xl border border-gray-200 bg-gray-50 py-2.5 pl-11 pr-3 text-sm text-gray-900 placeholder-gray-400 focus:border-emerald-500 focus:ring-emerald-500"}):e.jsx("input",{value:_,onChange:s=>B(s.target.value),onFocus:()=>{S.length&&n(!0)},placeholder:"Search messages",className:"w-full rounded-xl border border-gray-200 bg-gray-50 py-2.5 pl-11 pr-3 text-sm text-gray-900 placeholder-gray-400 focus:border-emerald-500 focus:ring-emerald-500"}),m==="messages"&&Q?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>n(!1)}),e.jsx("div",{className:"absolute z-20 mt-2 w-full overflow-hidden rounded-2xl border border-gray-200 bg-white shadow-xl",children:e.jsx("div",{className:"max-h-80 overflow-y-auto custom-scrollbar",children:S.length?S.map(s=>e.jsx("button",{type:"button",onClick:()=>{n(!1),q(s.conversation_id)},className:"w-full px-4 py-3 text-left hover:bg-gray-50 border-b border-gray-100 last:border-b-0",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(y,{src:s.other_user?.avatar_url,alt:s.other_user?.name,size:"h-10 w-10"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("div",{className:"truncate text-sm font-black text-gray-900",children:s.other_user?.name}),e.jsx("div",{className:"text-[11px] text-gray-500 font-semibold",children:s.message?.created_at?new Date(s.message.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""})]}),e.jsx("div",{className:"truncate text-xs text-gray-500",children:s.message?.body})]})]})},s.message?.id)):e.jsxs("div",{className:"px-4 py-8 text-center",children:[e.jsx("div",{className:"text-sm font-black text-gray-900",children:"No results"}),e.jsx("div",{className:"mt-1 text-xs text-gray-500",children:"Try a different keyword."})]})})})]}):null]})]}),e.jsx("div",{className:"flex gap-2 bg-white px-3 pb-3 flex-shrink-0",children:["All","Unread","Favorites","Groups"].map(s=>e.jsx("button",{className:"rounded-full border border-gray-200 bg-white px-3 py-1.5 text-xs font-black text-gray-600 hover:bg-gray-50",children:s},s))}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:$.length>0?$.map(s=>e.jsxs("button",{type:"button",onClick:()=>q(s.id),className:"flex w-full items-center gap-3 px-3 py-3 border-b border-gray-100 transition "+(s.id===a?"bg-emerald-50":"hover:bg-gray-50"),children:[e.jsx(y,{src:s.other_user?.avatar_url,alt:s.other_user?.name}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"truncate text-sm text-gray-900 font-black",children:s.other_user?.name}),e.jsx("div",{className:"text-[11px] text-gray-500 font-semibold",children:s.last_message?.created_at?new Date(s.last_message.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""})]}),e.jsx("div",{className:"truncate text-xs text-gray-500 mt-0.5",children:s.last_message?.body||"Start chatting..."})]})]},s.id)):e.jsxs("div",{className:"p-10 text-center",children:[e.jsx("div",{className:"mx-auto flex h-14 w-14 items-center justify-center rounded-2xl bg-emerald-50 text-emerald-700",children:e.jsx(W,{className:"h-6 w-6"})}),e.jsx("div",{className:"mt-4 text-sm font-black text-gray-900",children:"No conversations yet"}),e.jsx("div",{className:"mt-1 text-xs text-gray-500",children:"Click + to start a new chat."})]})})]}),e.jsx("div",{className:`${a?"flex":"hidden sm:flex"} flex-1 flex-col h-full overflow-hidden`,children:a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between bg-white px-4 py-3 shadow-sm h-[72px] flex-shrink-0 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("button",{onClick:re,className:"sm:hidden p-1 -ml-1 text-gray-600",children:e.jsx(ce,{className:"h-6 w-6"})}),e.jsx(y,{src:f?.other_user?.avatar_url,alt:"User",size:"h-10 w-10"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-sm font-black text-gray-900 truncate",children:f?.other_user?.name}),e.jsx("div",{className:"text-xs text-gray-500",children:f?.other_user?.is_online?"Online":f?.other_user?.last_seen_at?`Last seen ${K(f.other_user.last_seen_at)}`:"Offline"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-gray-600",children:[e.jsxs("div",{className:"hidden lg:flex items-center gap-2 rounded-xl border border-gray-200 bg-white px-3 py-2 text-xs font-black",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsx(me,{className:"h-4 w-4"}),e.jsx("span",{className:"ml-1 border-l border-gray-200 pl-2",children:"Call"})]}),e.jsx("button",{type:"button",className:"inline-flex h-10 w-10 items-center justify-center rounded-xl border border-gray-200 bg-white hover:bg-gray-50","aria-label":"Search",children:e.jsx(I,{className:"h-5 w-5"})}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{type:"button",onClick:()=>j(s=>!s),className:"inline-flex h-10 w-10 items-center justify-center rounded-xl border border-gray-200 bg-white hover:bg-gray-50","aria-label":"More",children:e.jsx(H,{className:"h-5 w-5"})}),X?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>j(!1)}),e.jsxs("div",{className:"absolute right-0 z-20 mt-2 w-56 overflow-hidden rounded-2xl border border-gray-200 bg-white shadow-xl",children:[e.jsx("button",{type:"button",onClick:()=>{j(!1),a&&(window.location.href=route("messages.export",a))},className:"w-full px-4 py-3 text-left text-sm font-black text-gray-800 hover:bg-gray-50 border-b border-gray-100",children:"Export Chat"}),e.jsx("button",{type:"button",onClick:()=>{j(!1),a&&confirm("Delete this chat? This will remove it from your inbox.")&&L.delete(route("messages.destroy",a),{preserveScroll:!0})},className:"w-full px-4 py-3 text-left text-sm font-black text-rose-700 hover:bg-rose-50",children:"Delete Chat"})]})]}):null]})]})]}),e.jsx("div",{ref:A,className:"relative flex-1 overflow-y-auto px-4 sm:px-10 py-6 custom-scrollbar bg-gray-50",children:e.jsx("div",{className:"space-y-2",children:d.map(s=>{const r=s.sender?.id===p?.id;return e.jsx("div",{className:r?"flex justify-end":"flex justify-start",children:e.jsxs("div",{className:"relative max-w-[85%] sm:max-w-[65%] rounded-2xl px-4 py-2 shadow-sm border "+(r?"bg-emerald-600 border-emerald-600 text-white":"bg-white border-gray-200 text-gray-900"),children:[e.jsx("div",{className:"pr-12 text-sm leading-relaxed break-words",children:s.body}),e.jsxs("div",{className:"absolute bottom-1 right-1.5 flex items-center gap-1",children:[e.jsx("span",{className:r?"text-[11px] text-white/80":"text-[11px] text-gray-400",children:s.created_at?new Date(s.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""}),r&&e.jsx(ye,{className:"h-3 w-3 text-white/90"})]})]})},s.id)})})}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 bg-white px-2 sm:px-4 py-3 flex-shrink-0 min-h-[72px] border-t border-gray-200",children:[e.jsx("button",{type:"button",className:"hidden sm:inline-flex h-10 w-10 items-center justify-center rounded-xl border border-gray-200 bg-white hover:bg-gray-50 text-gray-600","aria-label":"Emoji",children:e.jsx(we,{className:"h-5 w-5"})}),e.jsx("button",{type:"button",className:"inline-flex h-10 w-10 items-center justify-center rounded-xl border border-gray-200 bg-white hover:bg-gray-50 text-gray-600","aria-label":"Attach",children:e.jsx(G,{className:"h-5 w-5"})}),e.jsxs("form",{onSubmit:se,className:"flex flex-1 items-center gap-2 sm:gap-4",children:[e.jsx("input",{value:i.data.body,onChange:s=>i.setData("body",s.target.value),placeholder:"Write a message...",className:"w-full rounded-xl border border-gray-200 bg-gray-50 py-3 px-4 text-sm text-gray-900 placeholder-gray-400 focus:border-emerald-500 focus:ring-emerald-500"}),i.data.body.trim()?e.jsx("button",{type:"submit",disabled:i.processing,className:"inline-flex h-11 w-11 items-center justify-center rounded-xl bg-emerald-600 text-white hover:bg-emerald-700 transition-colors","aria-label":"Send",children:e.jsx(xe,{className:"h-5 w-5"})}):e.jsx("div",{className:"inline-flex h-11 w-11 items-center justify-center rounded-xl border border-gray-200 bg-white text-gray-500",children:e.jsx(ve,{className:"h-5 w-5"})})]})]})]}):e.jsx("div",{className:"flex h-full flex-col items-center justify-center bg-white text-center px-6",children:e.jsxs("div",{className:"max-w-md space-y-4",children:[e.jsx("div",{className:"mx-auto flex h-24 w-24 items-center justify-center rounded-3xl bg-emerald-50 border border-emerald-100",children:e.jsx(W,{className:"h-12 w-12 text-emerald-600"})}),e.jsx("h1",{className:"text-3xl font-black text-gray-900",children:"Physioplanet Message Web"}),e.jsx("p",{className:"text-sm text-gray-500 leading-relaxed",children:"Start a conversation with members and colleagues."}),e.jsxs("div",{className:"pt-10 text-xs text-gray-400 flex items-center justify-center gap-1",children:[e.jsx(he,{className:"h-3 w-3"})," Private messaging"]})]})})})]}),e.jsx(ne,{show:J,onClose:()=>g(!1),maxWidth:"md",children:e.jsxs("div",{className:"bg-white text-gray-900 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 px-6 py-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"New Chat"}),e.jsx(ue,{className:"h-6 w-6 cursor-pointer text-gray-500 hover:text-gray-900",onClick:()=>g(!1)})]}),e.jsxs("div",{className:"flex border-b border-gray-200",children:[e.jsxs("button",{onClick:()=>P("individual"),className:`flex flex-1 items-center justify-center gap-2 py-4 text-sm font-bold transition-colors ${M==="individual"?"border-b-4 border-emerald-600 text-emerald-700":"text-gray-500 hover:bg-gray-50"}`,children:[e.jsx(ge,{className:"h-4 w-4"}),"Individual"]}),e.jsxs("button",{onClick:()=>P("group"),className:`flex flex-1 items-center justify-center gap-2 py-4 text-sm font-bold transition-colors ${M==="group"?"border-b-4 border-emerald-600 text-emerald-700":"text-gray-500 hover:bg-gray-50"}`,children:[e.jsx(be,{className:"h-4 w-4"}),"Group"]})]}),e.jsx("div",{className:"p-6",children:M==="individual"?e.jsxs("form",{onSubmit:Z,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(T,{htmlFor:"membership_number",value:"Select a member",className:"text-gray-600 mb-2"}),e.jsxs("div",{className:"relative",children:[e.jsx(I,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(U,{id:"membership_number",className:"block w-full pl-10 bg-gray-50 border-gray-200 text-gray-900 focus:ring-emerald-500 focus:border-emerald-500",value:l.data.membership_number,onChange:s=>l.setData("membership_number",s.target.value),placeholder:"Search by name or member ID"})]}),e.jsx(oe,{message:l.errors.membership_number,className:"mt-2"})]}),e.jsx("div",{className:"rounded-2xl border border-gray-200 overflow-hidden",children:e.jsx("div",{className:"max-h-72 overflow-y-auto custom-scrollbar bg-white",children:z.length?z.slice(0,10).map(s=>e.jsxs("button",{type:"button",onClick:()=>{l.setData("user_id",s.id),l.setData("membership_number",s.membership_number||"")},className:"flex w-full items-center gap-3 px-4 py-3 text-left transition border-b border-gray-100 last:border-b-0 "+(String(l.data.user_id)===String(s.id)?"bg-emerald-50":"hover:bg-gray-50"),children:[e.jsx(y,{src:s.avatar_url,alt:s.name,size:"h-10 w-10"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"truncate text-sm font-black text-gray-900",children:s.name}),e.jsx("div",{className:"truncate text-xs text-gray-500",children:s.membership_number?`Member ID: ${s.membership_number}`:"Member ID: â€”"})]}),String(l.data.user_id)===String(s.id)?e.jsx("span",{className:"text-[11px] font-black uppercase tracking-widest text-emerald-700",children:"Selected"}):null]},s.id)):e.jsxs("div",{className:"px-4 py-8 text-center",children:[e.jsx("div",{className:"text-sm font-black text-gray-900",children:"No suggestions"}),e.jsx("div",{className:"mt-1 text-xs text-gray-500",children:"Try a different name or member ID."})]})})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(R,{className:"bg-emerald-600 hover:bg-emerald-700",disabled:l.processing||!l.data.user_id&&!String(l.data.membership_number||"").trim(),children:"Start Chat"})})]}):e.jsxs("form",{onSubmit:ee,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(T,{htmlFor:"group_name",value:"Group Name",className:"text-gray-600 mb-2"}),e.jsx(U,{id:"group_name",className:"block w-full bg-gray-50 border-gray-200 text-gray-900 focus:ring-emerald-500 focus:border-emerald-500",value:o.data.name,onChange:s=>o.setData("name",s.target.value),placeholder:"Enter group name",required:!0})]}),e.jsxs("div",{children:[e.jsx(T,{htmlFor:"group_desc",value:"Description (Optional)",className:"text-gray-600 mb-2"}),e.jsx("textarea",{id:"group_desc",className:"block w-full rounded-xl border border-gray-200 bg-gray-50 text-gray-900 focus:ring-emerald-500 focus:border-emerald-500 resize-none h-24 text-sm",value:o.data.description,onChange:s=>o.setData("description",s.target.value),placeholder:"What's this group about?"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(R,{className:"bg-emerald-600 hover:bg-emerald-700",disabled:o.processing,children:"Create Group"})})]})})]})}),e.jsx("style",{children:`
                .custom-scrollbar::-webkit-scrollbar {
                    width: 6px;
                }
                .custom-scrollbar::-webkit-scrollbar-track {
                    background: transparent;
                }
                .custom-scrollbar::-webkit-scrollbar-thumb {
                    background: #d1d5db;
                }
                .custom-scrollbar::-webkit-scrollbar-thumb:hover {
                    background: #9ca3af;
                }
            `})]})}export{He as default};
